Criar e pagar um pedido com cart√£o
Esse guia descreve como criar e pagar um pedido com Cart√£o de Cr√©dito sem redirecionar o seu cliente para o ambiente do PagBank. Dessa forma, voc√™ tem maior controle sobre a experi√™ncia do cliente durante o processo de pagamento. Para implementar esse processo voc√™ ir√° utilizar:

O SDK do PagBank para criptografar os dados do cart√£o.
O endpoint Criar pedido disponibilizado pelo PagBank.
Criptografe o cart√£o
O primeiro passo para que voc√™ crie e pague um pedido usando Cart√£o de Cr√©dito √© criptografar os dados do cart√£o. Para isso o PagBank disponibiliza um SDK. Dessa forma, sua p√°gina tem acesso as fun√ß√µes de criptografia dos dados disponibilizada pelo PagBank. Assim, a criptografia dos dados sens√≠veis do Cart√£o de Cr√©dito √© feita diretamente no navegador, reduzindo o seu escopo PCI.

Outro benef√≠cio de utilizar o SDK do PagBank, √© que ele n√£o requer chamadas ao servidor. Ou seja, o processo de criptografia √© feito localmente. A criptografia utiliza a sua chave p√∫blica e √© realizada usando o algoritmo RSA. A fun√ß√£o que realiza a criptografia fornece uma string que pode ser descriptografada usando a chave privada, a qual apenas o PagBank tem acesso.

Para utilizar o SDK do PagBank voc√™ deve incluir o script apresentado a seguir antes de fechar a tag <body> da sua p√°gina:

HTML

<script src="https://assets.pagseguro.com.br/checkout-sdk-js/rc/dist/browser/pagseguro.min.js"></script>
Ap√≥s incluir o SDK voc√™ pode utilizar todas as fun√ß√µes disponibilizadas pelo PagBank. Para realizar a criptografia dos dados do Cart√£o de Cr√©dito voc√™ ir√° utilizar o m√©todo PagSeguro.encryptCard() fornecendo os seguintes dados:

Par√¢metro	Descri√ß√£o
publicKey	Sua chave p√∫blica. Acesse Introdu√ß√£o √†s chaves p√∫blicas para maiores detalhes.
holder	Nome completo do portador do cart√£o.
number	N√∫mero do Cart√£o de Cr√©dito.
expMonth	M√™s de expira√ß√£o do Cart√£o de Cr√©dito.
expYear	Ano de expira√ß√£o do Cart√£o de Cr√©dito.
securityCode	C√≥digo de seguran√ßa do Cart√£o de Cr√©dito.
üìò
Utilize os cart√µes de teste encriptados

Na p√°gina de cart√µes de teste voc√™ encontra uma lista de cart√µes fict√≠cios que quando utilizados resultam em transa√ß√µes com resultados pr√©-estabelecidos. Assim, voc√™ pode testar a aplica√ß√£o j√° sabendo seu resultado.

Al√©m disso, voc√™ consegue executar a criptografia dos cart√µes diretamente nessa p√°gina. Selecione o cart√£o de teste desejado e utilize o bot√£o Criptografe este cart√£o para ter os dados do cart√£o criptografados disponibilizados na sua √°rea de transfer√™ncia. Assim, voc√™ pode pular a etapa de criptografia em seus testes iniciais.

A seguir √© apresentado um exemplo de criptografia dos dados do cart√£o utilizando o m√©todo encryptCard:

JavaScript

const card = PagSeguro.encryptCard({
  publicKey: "MINHA_CHAVE_PUBLICA",
  holder: "Nome Sobrenome",
  number: "4242424242424242",
  expMonth: "12",
  expYear: "2030",
  securityCode: "123"
});

const encrypted = card.encryptedCard;
const hasErrors = card.hasErrors;
const errors = card.errors;
Conforme apresentado no exemplo acima, o m√©todo encryptCard fornece um objeto. Os dados desse objeto s√£o listados e descritos na tabela a seguir:

Par√¢metro	Descri√ß√£o
encryptedCard	Cart√£o criptografado, que deve ser adicionado √† requisi√ß√£o ao endpoint Criar pedido.
hasErrors	Determina se houve, ou n√£o, algum erro durante o processo de criptografia.
errors	Se algum erro ocorreu durante a criptografia, esse par√¢metro fornece uma lista dos erros, incluindo seu c√≥digo e mensagem de erro.
Os poss√≠veis erros decorrentes do processo de criptografia dos dados do cart√£o contidos no par√¢metro errors s√£o apresentados na sequ√™ncia:

C√≥digo (code)	Mensagem (message)
INVALID_NUMBER	Invalid card number
INVALID_SECURITY_CODE	Invalid field securityCode. You must pass a value with 3, 4 or none digits
INVALID_EXPIRATION_MONTH	Invalid field expMonth. You must pass a value between 1 and 12
INVALID_EXPIRATION_YEAR	Invalid field expYear. You must pass a value with 4 digits
INVALID_PUBLIC_KEY	Invalid publicKey
INVALID_HOLDER	Invalid holder
Crie e pague o pedido
Com os dados do cart√£o criptografados em m√£os e os dados do pedido, voc√™ pode criar o pedido. Para isso, voc√™ ir√° utilizar o endpoint Criar pedido.

Para realizar a requisi√ß√£o ao endpoint Criar pedido, voc√™ precisa fornecer no corpo da requisi√ß√£o os dados descritos no Objeto Order. Os dados do pagamento devem ser adicionados ao objeto charge. A p√°gina Objeto Charge descreve em detalhes cada um dos par√¢metros que devem ser inclu√≠dos.

Os dados resultantes da encripta√ß√£o do Cart√£o de Cr√©dito (encryptedCard) devem ser adicionados ao campo charges.payment_method.card.encrypted. Al√©m disso, para que a captura da cobran√ßa seja feita de forma autom√°tica, junto com a cria√ß√£o do pedido, voc√™ deve encaminhar o par√¢metro charges.payment_method.capture com o valor true.

Na p√°gina do endpoint Criar pedido voc√™ encontra exemplos de request e reponse nomeados Criar pedido com cart√£o. Esses mesmos exemplos s√£o apresentados a seguir.

Request
Response

curl --location --request POST 'https://sandbox.api.pagseguro.com/orders' \
--header 'Authorization: Bearer {{}}' \
--header 'Content-Type: application/json' \
--data-raw '{
    "reference_id": "ex-00001",
    "customer": {
        "name": "Jose da Silva",
        "email": "email@test.com",
        "tax_id": "12345678909",
        "phones": [
            {
                "country": "55",
                "area": "11",
                "number": "999999999",
                "type": "MOBILE"
            }
        ]
    },
    "items": [
        {
            "reference_id": "referencia do item",
            "name": "nome do item",
            "quantity": 1,
            "unit_amount": 500
        }
    ],
    "shipping": {
        "address": {
            "street": "Avenida Brigadeiro Faria Lima",
            "number": "1384",
            "complement": "apto 12",
            "locality": "Pinheiros",
            "city": "S√£o Paulo",
            "region_code": "SP",
            "country": "BRA",
            "postal_code": "01452002"
        }
    },
    "notification_urls": [
        "https://meusite.com/notificacoes"
    ],
    "charges": [
        {
            "reference_id": "referencia da cobranca",
            "description": "descricao da cobranca",
            "amount": {
                "value": 500,
                "currency": "BRL"
            },
            "payment_method": {
                "type": "CREDIT_CARD",
                "installments": 1,
                "capture": true,
                "card": {
                    