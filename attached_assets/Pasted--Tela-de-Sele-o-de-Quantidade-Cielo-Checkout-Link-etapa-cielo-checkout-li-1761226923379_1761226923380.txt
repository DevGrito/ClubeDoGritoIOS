  {/* Tela de Seleção de Quantidade - Cielo Checkout Link */}
        {etapa === 'cielo-checkout-link' && (
          <div className="bg-white border-2 border-gray-200 rounded-xl p-6 max-w-md mx-auto">
            <h2 className="text-2xl font-bold text-center mb-6" data-testid="titulo-cielo-checkout">
              Escolha a forma de pagamento
            </h2>
            
            {/* Box principal com borda cyan */}
            <div className="border-2 border-cyan-400 rounded-xl p-6 mb-6">
              <h3 className="text-lg font-semibold text-center mb-4">
                Pagar com Cartão ou PIX
              </h3>
              
              <p className="text-center text-gray-700 mb-4">
                Quantos ingressos você quer comprar?
              </p>
              
              {/* Seletor de Quantidade - Grid de botões */}
              <div className="grid grid-cols-5 gap-2 mb-2">
                {[1, 2, 3, 4, 5].map((qtd) => (
                  <button
                    key={qtd}
                    type="button"
                    onClick={() => setCieloLinkQty(qtd)}
                    className={`h-12 rounded-lg font-semibold transition ${
                      cieloLinkQty === qtd
                        ? 'bg-cyan-500 text-white'
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }`}
                    data-testid={`button-qty-${qtd}`}
                  >
                    {qtd}
                  </button>
                ))}
              </div>
              
              <div className="grid grid-cols-5 gap-2 mb-6">
                {[6, 7, 8, 9, 10].map((qtd) => (
                  <button
                    key={qtd}
                    type="button"
                    onClick={() => setCieloLinkQty(qtd)}
                    className={`h-12 rounded-lg font-semibold transition ${
                      cieloLinkQty === qtd
                        ? 'bg-cyan-500 text-white'
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }`}
                    data-testid={`button-qty-${qtd}`}
                  >
                    {qtd}
                  </button>
                ))}
              </div>
              
              {/* Resumo do valor */}
              <div className="mb-6">
                <p className="text-center text-gray-600 text-sm mb-1">
                  {cieloLinkQty} ingresso{cieloLinkQty > 1 ? 's' : ''} × R$ 1.000,00
                </p>
                <p className="text-center text-2xl font-bold text-cyan-600">
                  Total: R$ {(cieloLinkQty * 1000).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                </p>
              </div>
              
              {/* Botão de Pagamento */}
              <button
                onClick={async () => {
                  // Proteção contra cliques múltiplos
                  if (isProcessingCieloLink) {
                    return;
                  }
                  
                  try {
                    setIsProcessingCieloLink(true);
                    setIsCreatingPayment(true);
                    
                    // Chamar API para criar ingressos no banco e obter link
                    const response = await fetch('/api/ingresso/cielo-link', {
                      method: 'POST',
                      headers: {
                        'Content-Type': 'application/json',
                      },
                      body: JSON.stringify({
                        nome,
                        telefone,
                        email,
                        quantidade: cieloLinkQty
                      })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success && data.checkoutLink) {
                      // Abrir link da Cielo em nova janela
                      window.open(data.checkoutLink, '_blank');
                      toast({
                        title: "Ingressos reservados!",
                        description: `${cieloLinkQty} ingresso(s) criado(s). Complete o pagamento na Cielo.`,
                      });
                    } else {
                      toast({
                        title: "Erro",
                        description: data.error || "Erro ao criar ingressos",
                        variant: "destructive"
                      });
                    }
                  } catch (error) {
                    console.error('Erro ao criar ingressos:', error);
                    toast({
                      title: "Erro",
                      description: "Erro ao processar sua solicitação",
                      variant: "destructive"
                    });
                  } finally {
                    setIsCreatingPayment(false);
                    // Mantém bloqueado por 3 segundos para evitar cliques acidentais
                    setTimeout(() => {
                      setIsProcessingCieloLink(false);
                    }, 3000);
                  }
                }}
                disabled={isCreatingPayment || isProcessingCieloLink}
                className="w-full bg-cyan-500 text-white py-4 rounded-xl hover:bg-cyan-600 transition font-semibold text-lg disabled:bg-gray-400 disabled:cursor-not-allowed"
                data-testid="button-pagar-cielo-link"
              >
                {isCreatingPayment ? 'Criando ingressos...' : 'Pagar com Cartão ou PIX'}
              </button>
              
              <p className="text-center text-xs text-gray-500 mt-3">
                Abre checkout Cielo em nova janela
              </p>
            </div>
            
            {/* Botão Voltar */}
            <button
              onClick={voltarInicial}
              className="w-full bg-gray-200 text-gray-700 py-3 rounded-xl hover:bg-gray-300 transition"
              data-testid="button-voltar-cielo"
            >
              Voltar
            </button>
          </div>
        )}